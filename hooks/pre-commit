#!/bin/bash
# Pre-commit hook - ensures code quality before committing
# This hook runs automatically before every git commit
#
# Checks performed:
# - Version update validation
# - Code linting (if configured)
# - Basic syntax checks

set -e

echo "ğŸ” Pre-commit checks..."

# Check if version.ts exists and is executable
if [ -f "./scripts/version.ts" ]; then
  # Verify version was updated (if package.json changed)
  if git diff --cached --name-only | grep -q "package.json"; then
    echo "ğŸ“¦ package.json changed - verifying version update..."
    
    # Run version check
    if command -v tsx &> /dev/null; then
      tsx ./scripts/version.ts --verify-commit || {
        echo "âŒ Version not updated in package.json!"
        echo "   Run: npm version patch|minor|major"
        exit 1
      }
    else
      echo "âš ï¸  Warning: tsx not found, skipping version check"
    fi
  fi
fi

# Run linting if available
if grep -q '"lint"' package.json 2>/dev/null; then
  echo "ğŸ§¹ Running linter..."
  npm run lint --silent || {
    echo "âŒ Linting failed!"
    echo "   Fix the linting errors before committing."
    exit 1
  }
fi

echo "âœ… Pre-commit checks passed"
exit 0
